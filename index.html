<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Multishop Simulator - Risk of Rain 2 Item Ranker</title>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<!--
			It's impossible to have mysteries nowadays
			Because of nosey people like you
			Please keep all of this between us
			If you post it online, I won't make any more secrets.
			No one will be impressed
			It will be your faaaaault
			heheh hee h eh ha ah  eh eah  h ae h



⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣈⣿⣿⣿⣿⣿⣇⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣤⣤⡀⠀⣠⣼⣿⣿⣿⠿⠿⢯⡿⠿⢤⡀⠀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⡝⠀⠀⠀⠈⠸⠗⠽⣼⣿⣿⣿⣿⢆⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣴⣷⣧⣤⡀⢰⣷⣻⣿⣿⣿⣿⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠉⢹⣿⣿⣿⣿⣿⡝⣴⣿⣿⣿⣯⣍⠀⠈⡌⡟⠛⠛⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣽⣿⣿⣿⣿⣿⣿⣿⠣⣺⣗⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣿⣟⣝⢻⡿⠟⣻⡟⠋⠉⢋⡟⣷⠎⣄⢁⠊⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⡇⠀⡀⣿⡧⠀⡴⡾⠰⠁⢙⣦⣭⣼⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠻⣿⣿⣾⣄⣿⣿⣾⣆⣤⣖⣠⣾⡗⣾⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⢰⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⡠⠤⣠⣶⣝⣿⣿⣿⣿⡛⠑⢩⣿⡿⠓⠛⠉⣁⢎⣮⣰⣿⣏⢶⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣠⣾⣷⣿⣶⣿⣿⣿⣿⣿⣿⣿⣿⡓⣿⣿⣿⠀⠀⣀⣷⢿⣿⣿⣿⠩⢙⣯⣗⣎⣭⣲⣄⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣠⣾⣿⣿⣿⣯⣽⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡷⡶⢻⢿⣿⣿⣿⣿⣩⠀⠄⠰⠍⢢⠀⠀⠀⠀
⠀⠀⢀⣼⣿⣿⣿⣿⣿⣿⣇⣠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣭⠁⠈⠙⢻⣋⣹⠐⠀⣿⣿⣿⣿⣷⣖⠁⡀⠀⠓⢣⠀⠀⠀
⠀⣠⠾⠙⠻⣿⣿⣿⣿⣿⣿⣿⡿⢻⣿⣿⣿⣿⣿⣿⡿⠿⠁⠀⠀⠀⠹⢁⠑⠀⡘⡿⣿⣿⣿⣯⢂⣄⡀⠘⣳⡆⠀⠀
⣼⣷⣏⣠⣌⣨⣿⣿⣿⣿⡟⠋⢠⣿⣿⣿⣿⣿⣿⣿⣷⣮⠁⠀⠀⠀⠀⢣⣈⠁⢃⡹⣿⣿⣿⣿⣖⠎⠁⠀⠁⡸⡀⠀
⣿⣿⡿⣿⣯⡿⢵⣿⣿⣿⡶⢆⣾⣿⣿⣿⣿⣿⣿⠛⠛⠋⠀⠀⠀⠀⠀⠀⣗⠑⠈⠁⡹⣿⠻⣿⣿⣷⣵⣦⣤⠊⠁⠀
⠹⣿⣯⣽⣿⣾⣷⡟⠙⠻⢯⠋⣿⣿⣿⣿⣿⣿⣾⣤⡀⠀⠀⠀⠀⠀⠀⠀⢸⠙⠨⢔⠅⣿⡀⠈⣻⣿⣿⡇⠑⠫⠑⡄
⠀⠈⠻⢿⣿⣿⡟⠻⢦⣤⠃⢸⣿⣿⣿⣿⣿⣿⣿⡋⠊⠀⠀⠀⠀⠀⠀⠀⠈⣞⣣⢴⢺⣿⡇⢠⣿⣿⣿⠂⠂⠀⠃⢡
⠀⠀⠀⢸⣿⡿⢿⣤⣤⡜⠀⠘⣿⣿⣿⣿⣿⣿⡿⡋⡷⡂⢀⠀⠀⠀⡀⠀⠀⣗⣿⣓⣾⣿⠇⢸⣿⣿⣿⣧⠠⠀⢲⣸
⠀⠀⠀⠈⠻⢿⣦⣖⡺⠁⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣵⠐⡈⠀⠀⠀⠀⠀⠀⣷⣝⣄⣿⣿⠀⢸⣿⣿⣷⠊⠀⠀⣢⡇
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⣿⣿⣿⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⠀⡟⡻⢹⣿⠇⠀⠘⣿⣿⣷⣷⣥⣄⡿⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣽⣿⣿⣿⣿⣫⡟⠊⠁⠀⠀⠀⠀⠀⠀⢀⢗⣽⣾⣯⡄⠀⢀⣾⠿⡟⢿⢟⣋⠁⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣷⣧⣤⣤⣄⣠⡤⣴⣿⣿⣿⣿⣿⣷⣿⣟⢁⢸⠁⠤⣣⡟⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣿⣿⣿⣿⣿⣿⣿⣤⢦⠜⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡅⠈⠀⠨⢪⢁⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣵⣿⣿⣿⣿⣿⣿⣿⣿⠿⢿⣷⡟⡠⡷⠁⢂⠧⢹⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⡻⢿⣿⣿⣿⣿⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣿⣿⣇⣽⡇⣠⣾⢹⡎⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⣿⠥⠓⠊⠝⣻⣿⠀⠀⣿⣿⣿⣿⡿⡿⡿⠟⢑⣾⠀⠈⠛⠓⠚⠛⠚⠁⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⡊⢀⠀⠀⠐⣿⠀⠀⣿⣿⣿⡿⠉⢠⢁⡀⠼⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⣿⣿⡿⢒⡐⣄⣴⡿⠀⠀⢹⣿⣿⣿⢀⠀⠀⢀⣭⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⡿⢾⠿⢿⡾⠁⠀⠀⠈⢿⣿⣿⣿⠷⠿⡾⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣽⣿⣿⣿⣇⣠⣴⡎⠀⠀⠀⠀⢸⣿⣿⣿⣾⡅⣌⣿⡅⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⣿⣿⣿⢏⠉⠉⢹⢷⠀⠀⠀⠀⢸⣿⣿⣿⡏⠁⠀⠪⣱⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⡿⠿⠧⠀⠀⣺⠀⠀⠀⠀⢸⣿⣿⣿⢄⠀⠄⠌⡉⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⡃⠀⡀⠀⢠⣿⠀⠀⠀⠀⢸⣿⣿⣿⡄⠗⠀⢀⣸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢹⣿⣿⣷⢞⡔⠀⠺⡇⠀⠀⠀⠀⢸⣿⣿⣿⣧⡂⢀⠴⣶⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⢿⣿⣿⠇⠀⢠⣃⠇⠀⠀⠀⠀⠀⣿⣿⣿⡟⣏⢀⣹⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠤⣶⣿⣿⣿⣿⣗⠒⢿⣷⡄⠀⠀⠀⣠⣾⣿⣿⣷⠚⢳⣾⣦⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⣠⣤⣶⣾⣥⡾⣿⠟⣫⣾⣿⣿⣄⣤⣿⣿⠀⠀⡼⣾⣿⣩⣿⣿⣷⣹⣿⡿⢮⣇⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣼⣿⣿⣿⣿⣷⣾⣯⣸⣿⣿⡿⢉⣀⢹⣿⣿⣧⣾⣿⣯⣽⣿⣿⣿⠇⠉⣿⣧⣦⣱⡵⣆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠸⢿⣿⣿⣿⣿⣿⣿⡺⢼⣿⣿⣗⡊⣘⣹⡛⢋⣿⣿⣟⠪⢻⣿⣿⣿⠂⠧⣽⣿⣧⠁⠀⣟⡄⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠉⠀⠉⠉⠛⠓⠒⠒⠚⠁⠈⠛⠻⠧⠤⠛⠛⠿⠯⠿⠬⠞⠛⠻⠭⠝⠓⠂⠀⠀⠀⠀⠀
		-->
		<div class="container center-both">
			<a href="./rankings.html">See the Rankings</a><br>
			You are <span id="survivor"></span><br>
			<div class="image-container">
				<img class="item-image" id="item-image-0">
				<img class="item-image" id="item-image-1">
				<img class="item-image" id="item-image-2">
			</div>
			<button class="hide-on-desktop" id="submit-button">Submit</button>
			<div class="hide-on-desktop" id="mobile-tooltip"></div>
			<button onclick="randomizeItems()">Scrap all three!</button><br>
			<button onclick="randomizeItems()">I'm not well informed enough to make a sound descision</button>
			<br><br><br><br>
			Check out my <a href="https://therealohead.github.io/homepage">homepage</a>!
		</div>
		<div id="tooltip"></div>
		<script type="text/javascript" src="./common_functions.js"></script>
		<script type="text/javascript">
			let itemList = {};
			let debugTable;
			let currentItems = [];
			let currentSurvivor = 'Potmobile';
			let currentLoadout = [];
			let tooltipElement = runningOnTouchScreen() ? document.getElementById('mobile-tooltip') : document.getElementById('tooltip');
			let survivors;
			let survivorVariations;
			let mobileSelectedItemElement = document.createElement('dummy');

			const submitButton = document.getElementById('submit-button');


			if (!runningOnTouchScreen()) document.addEventListener('mousemove',(e)=>{
				tooltipElement.style.left = e.clientX + 'px';
				tooltipElement.style.top  = e.clientY + 20 + 'px';
			});

			function refreshTooltip(element) {
				// Generate tooltip
				let item = currentItems[element.id.substr('item-image-'.length)];
				tooltipElement.innerHTML = `${item.name}<br>
				<span class="${item.itemRarity}">${item.itemRarity}</span><br>
				${item.description}`
				tooltipElement.style.display = 'block';
			}

			function submitItem(item) {
				let xhr = new XMLHttpRequest();
				xhr.open("POST", window.location.href.split('/').slice(0,3).join('/') + '/submit', true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.send(JSON.stringify({
				    itemName: item.name,
				    survivor: currentSurvivor,
				    loadout: currentLoadout
				}));

			}


			Array.prototype.slice.call(document.getElementsByClassName('item-image')).forEach(element=>{
				if (!runningOnTouchScreen()) element.addEventListener('mouseenter',()=>{
					refreshTooltip(element)
				});
				if (!runningOnTouchScreen()) element.addEventListener('mouseleave',()=>{
					tooltipElement.style.display = 'none';
				});

				// Desktop click functionality
				if (!runningOnTouchScreen()) element.addEventListener('click',()=>{
					let item = currentItems[element.id.substr('item-image-'.length)];
					submitItem(item);
					randomizeItems();
				});

				// Mobile click functionality
				if (runningOnTouchScreen()) element.addEventListener('touchend',()=>{
					mobileSelectedItemElement.classList.remove('selected-item');
					mobileSelectedItemElement = element;
					mobileSelectedItemElement.classList.add('selected-item');
					refreshTooltip(element);
				});
			});
			submitButton.addEventListener('touchend',()=>{
				let item = currentItems[mobileSelectedItemElement.id.substr('item-image-'.length)];
				submitItem(item);
				randomizeItems();
				mobileSelectedItemElement.classList.remove('selected-item');
				mobileSelectedItemElement = document.createElement('dummy');
				tooltipElement.innerHTML = '';
			})


			


			function randomizeItems() {
				// Randomize survivor
				let survivorElement = document.getElementById('survivor');
				let survivor = currentSurvivor = randomElement(survivors);
				survivorElement.innerHTML = survivor;

				// Randomize loadout
				currentLoadout = [];
				if (survivorVariations[survivor].length > 0) {
					survivorElement.innerHTML += ' (';
					survivorVariations[survivor].forEach(slot=>{
						let ability = randomElement(slot);
						currentLoadout.push(ability);
						survivorElement.innerHTML += ability + ', ';
					})
					survivorElement.innerHTML = survivorElement.innerHTML.substr(0,survivorElement.innerHTML.lastIndexOf(', ')) + ')';
				} 


				// Get random rarity (weighted based on item amounts)
				//let rarity = rarities[Math.floor(Math.random() * rarities.length)]
				let rarity = undefined;
				while (!rarities.includes(rarity)) {
					rarity = itemList[Object.keys(itemList)[Math.floor(Math.random() * Object.keys(itemList).length)]].itemRarity;
				}


				// Set each image to a random item
				for (let i = 0; i < 3; i++) {
					// Get random item
					let item = {
						itemRarity: undefined
					}
					while (item.itemRarity != rarity || currentItems.includes(item)) {
						item = itemList[Object.keys(itemList)[Math.floor(Math.random() * Object.keys(itemList).length)]];
					}

					let url = getItemURL(item, item.magicByte);
					document.getElementById('item-image-' + i).src = url;
					currentItems[i] = item;
				}
			}


			fetch('survivor_data.json')
				.then((response) => response.json())
				.then((data) => {
					survivors = data.survivors;
					survivorVariations = data.survivorVariations;

			fetch('items.json')
				.then((response) => response.json())
				.then((data) => {
					itemList = data;

			// I got these bytes by scraping the wiki. Need them to retrieve item images
			fetch('magic_bytes.json')
				.then((response) => response.json())
				.then((data) => {

					magicBytes = data;

					for (let i = 0; i < Object.keys(itemList).length; i++) {
						let item = itemList[Object.keys(itemList)[i]];
						item.magicByte = magicBytes[item.name];
					}

					// Get rid of WorldUnique items (stuff like Halcyon Seed and Captain's Microbots)
					let itemListSansWorldUnique = {};
					Object.keys(itemList).forEach((itemKey)=>{
						let item = itemList[itemKey];
						if (!item.hasOwnProperty('category') || !item.category.includes('WorldUnique')) {
							itemListSansWorldUnique[itemKey] = item;
						}
					})
					itemList = itemListSansWorldUnique;

					randomizeItems();

				});


				});


				});

		</script>
	</body>
</html>